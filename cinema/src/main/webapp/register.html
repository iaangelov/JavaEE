<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Register</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<link rel="stylesheet" type="text/css" href="styles/bootstrap.css" />
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<script type="text/javascript" src="js/functions.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		redirectAuthorised();
	});
	
	function register() {
	    var formUrl = $("#register_form").attr("action");
	    var username = $("#userName")[0].value;
	    var password = $("#pwd")[0].value;
	    var email = $("#email")[0].value;
	    
	    if(!isPasswordValid(password)) {
	        return ;
	    }
	    
	    var data = { user : {
		            username : username,
		            password : password,
		            email : email
    			}
	    }
	    
		$.ajax({
		    url: 'rest/user',
		    type: "POST",
		    contentType: "application/json;charset=UTF-8",
		    data: JSON.stringify(data)
		})
		.success(function(data) {
		    $("#register_form").attr("action", "index.html");
		})
		.fail(function(data) {
		    $("#register_form").attr("action", "register.html");

		})
		.always(function() {
                    $("#register_form").submit();
        });
    }

    function isPasswordValid(password) {
        var confirmPassword = $("#conf_pwd")[0].value;

        if (password == "" || confirmPassword == "") {
            alert("Please fill both fields for password and try again.");
            return false;
        }

        if (password != confirmPassword) {
            alert("Two passwords do not match. Please correct the values and try again.");
            return false;
        }
        return true;
    }
</script>
</head>
<body>

	<div class="container">
		<div class="row">
			<div class="col-sm-6 col-md-4 col-md-offset-4">
				<h1 class="text-center login-title">Register</h1>
				<div class="account-wall">

					<form id="register_form" class="form-signin" role="form" method="post">
						<input type="text" class="form-control" name="username"
							id="userName" placeholder="Username" required autofocus>
						<input type="password" class="form-control" name="password"
							id="pwd" placeholder="Password" required>
					    <input
							type="password" class="form-control" name="confirm_password" id="conf_pwd"
							placeholder="Confirm Password" required>
							<input type="text" class="form-control" name="email"
							id="email" placeholder="Email">
						<button id="btnLgnReg" class="btn btn-lg btn-primary btn-block" type="button"
							onclick="register()">Register</button>
					</form>
				</div>
				<div style="display: inline-flex">
					<a class="text-center new-account"
						style="text-align: left; display: inline; margin-right: 260px;"
						href="login.html">Sign in</a> <a class="text-center new-account"
						style="text-align: right; display: inline;" href="index.html">Go
						home </a>
				</div>
			</div>
		</div>
	</div>


</body>
</html>